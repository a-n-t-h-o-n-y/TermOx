cmake_minimum_required(VERSION 3.18)
project(TermOx VERSION 2.0.0 LANGUAGES CXX)

# Enable AddressSanitizer for debug builds
if (CMAKE_BUILD_TYPE STREQUAL "Debug")
    message(STATUS "AddressSanitizer enabled for Debug build")

    if (CMAKE_CXX_COMPILER_ID MATCHES "Clang|GNU")
        add_compile_options(-fsanitize=address -fno-omit-frame-pointer)
        add_link_options(-fsanitize=address)
    elseif (CMAKE_CXX_COMPILER_ID MATCHES "MSVC")
        message(WARNING "AddressSanitizer is not supported on MSVC")
    endif()
endif()

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# Add External Dependencies
add_subdirectory(external/Escape)
add_subdirectory(external/signals-light)

# Create Library Target
add_library(TermOx STATIC
    src/application.cpp
    src/bordered.cpp
    src/button.cpp
    src/checkbox.cpp
    src/label.cpp
    src/lineedit.cpp
    src/focus.cpp
    src/scrollbar.cpp
    src/textbox.cpp
    src/widget.cpp
    src/core/terminal.cpp

    include/ox/ox.hpp
    include/ox/application.hpp
    include/ox/bordered.hpp
    include/ox/button.hpp
    include/ox/checkbox.hpp
    include/ox/focus.hpp
    include/ox/label.hpp
    include/ox/layout.hpp
    include/ox/lineedit.hpp
    include/ox/scrollbar.hpp
    include/ox/textbox.hpp
    include/ox/widget.hpp

    include/ox/core/common.hpp
    include/ox/core/core.hpp
    include/ox/core/events.hpp
    include/ox/core/glyph.hpp
    include/ox/core/terminal.hpp
)

# Include Directories for the Library
target_include_directories(TermOx PUBLIC
    ${PROJECT_SOURCE_DIR}/include
)

# Compiler Options for the Library
target_compile_options(TermOx PRIVATE
    $<$<CXX_COMPILER_ID:MSVC>:/W4 /permissive->
    $<$<OR:$<CXX_COMPILER_ID:Clang>,$<CXX_COMPILER_ID:GNU>>:
        -Wall -Wextra -Wpedantic -Wconversion>
)

# Link External Libraries to the Library Target
target_link_libraries(TermOx PUBLIC
    escape
    signals-light
)

# Add the tests subdirectory
add_subdirectory(tests)
add_subdirectory(examples)